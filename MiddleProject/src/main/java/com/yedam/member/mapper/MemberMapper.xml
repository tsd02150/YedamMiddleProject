<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.member.mapper.MemberMapper">
<insert id="insertMember" parameterType="member">
	insert into member(member_no,id,pw,name,adress,phone,grade,rrn,gender,email)
	values(member_seq.nextval,#{id},#{pw},#{name},#{adress},#{phone},#{grade},#{rrn},#{gender},#{email})
</insert>
<update id="updateMember" parameterType="member">
	update member set company_no=
		(select company_no
		from company
		where crn=#{crn}) 
	where id=#{id}
</update>
<select id="loginCheck" resultType="member" parameterType="member">
		select * from member
		where id=#{id} and pw=#{pw}
	</select>
	<select id="memberInfo" resultType="member" parameterType="String">
		select * from member where id = #{id}
	</select>
	<select id="searchId" resultType="String" parameterType="member">
		select id from member where name=#{name} and rrn=#{rrn}
	</select>
	<select id="searchPw" resultType="String" parameterType="member">
		select pw from member where id=#{id} and name=#{name} and rrn=#{rrn}
	</select>
	<update id="updateMemberM" parameterType="member">
		update member
		set pw=#{pw}, phone=#{phone}, adress=#{adress}, email=#{email}
		where id=#{id}
	</update>
 	<select id="qnaList" parameterType="String" resultType="qna">
 		select * from qna join member using (member_no)
		where id = #{id};
 	</select>
 	<select id="qnaWithPage" resultType="qna">
  <![CDATA[
  	select b.* 
  		from (select rownum rn, a.*
         	 from( select * from qna
           	   order by 1 desc) a
           	 where rownum <=${page}*10 ) b
		where b.rn >(${page}-1)*10
	]]>
 	</select>
 	<select id="getCount" resultType="int">
		select count(*) from qna
	</select>
 	<select id="wishList" resultType="wish" parameterType="String">
 		select * from
		(select b.board_thumbnail,p.product_no,p.product_name,b.board_content,p.price,p.product_count,
		s.sub_category_name,m.id,w.wish_no
		from wish w, product p, member m,board b,subcategory s
		where w.product_no = p.product_no
		and w.member_no = m.member_no
		and b.product_no = p.product_no
		and s.sub_category_no = p.sub_category_no)
		where id = #{id}
 	</select>
 	
 	<select id="orderList" resultType="order" parameterType="String">
 		select * from (
    select * from (
        select * from product p join board b 
        on(p.product_no = b.product_no)
    )z
    join(
    select * from (
        member m join
        (select * from orders o join order_detail od 
        on(o.order_no = od.order_no)
        )a  
        using(member_no)))q 
    on(q.member_no = z.member_no))
    where id = #{id}
 	</select>
 	
 	
 	
</mapper>